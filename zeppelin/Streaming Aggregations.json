{"paragraphs":[{"text":"  case class Activity(timestamp_hour: Long,\r\n                      referrer: String,\r\n                      action: String,\r\n                      prevPage: String,\r\n                      visitor: String,\r\n                      page: String,\r\n                      product: String,\r\n                      inputProps: Map[String, String] = Map()\r\n                     )\r\n  case class ActivityByProduct( product: String,\r\n                                timestamp_hour: Long,\r\n                                purchase_count : Long,\r\n                                add_to_cart_count: Long,\r\n                                page_view_count: Long)","dateUpdated":"2019-02-27T15:10:40-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1551296967389_-1397169127","id":"20190227-144927_507766680","result":{"code":"SUCCESS","type":"TEXT","msg":"\ndefined class Activity\n\ndefined class ActivityByProduct\n"},"dateCreated":"2019-02-27T14:49:27-0500","dateStarted":"2019-02-27T15:10:40-0500","dateFinished":"2019-02-27T15:10:41-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:28"},{"text":"import org.apache.spark.streaming.{Duration, Seconds, StreamingContext}\n\n@transient val ssc = new StreamingContext(sc, Seconds(4))\nssc.checkpoint(\"hdfs://lambda-pluralsight:9000/spark/checkpoint\")\n","dateUpdated":"2019-02-27T15:10:40-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1551297404712_1584495287","id":"20190227-145644_1002379280","result":{"code":"SUCCESS","type":"TEXT","msg":"\nimport org.apache.spark.streaming.{Duration, Seconds, StreamingContext}\n\nssc: org.apache.spark.streaming.StreamingContext = org.apache.spark.streaming.StreamingContext@413a6a10\n"},"dateCreated":"2019-02-27T14:56:44-0500","dateStarted":"2019-02-27T15:10:40-0500","dateFinished":"2019-02-27T15:10:42-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:29"},{"text":"val inputPath = \"file:///vagrant/input\"\nval textDStream = ssc.textFileStream(inputPath)\n      val activityStream = textDStream.transform(input => {\n        input.flatMap { line =>\n          val record = line.split(\"\\\\t\")\n          val MS_IN_HOUR = 1000 * 60 \n          if (record.length == 7)\n            Some(Activity(record(0).toLong / MS_IN_HOUR * MS_IN_HOUR, record(1), record(2), record(3), record(4), record(5), record(6)))\n          else\n            None\n        }\n      })\n      \n      \nactivityStream.foreachRDD(rdd => {\n        val df = rdd.toDF()\n        df.registerTempTable(\"activity\")\n        val activityByProduct = sqlContext.sql(\"\"\"SELECT\n                                            product,\n                                            timestamp_hour,\n                                            sum(case when action = 'purchase' then 1 else 0 end) as purchase_count,\n                                            sum(case when action = 'add_to_cart' then 1 else 0 end) as add_to_cart_count,\n                                            sum(case when action = 'page_view' then 1 else 0 end) as page_view_count\n                                            from activity\n                                            group by product, timestamp_hour \"\"\")\n        activityByProduct\n          .registerTempTable(\"activityByProduct\")\n      } )\n\n      ssc.start()   \n      ","dateUpdated":"2019-02-27T15:10:40-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1551297497430_-647327458","id":"20190227-145817_553131869","result":{"code":"SUCCESS","type":"TEXT","msg":"\ninputPath: String = file:///vagrant/input\n\ntextDStream: org.apache.spark.streaming.dstream.DStream[String] = org.apache.spark.streaming.dstream.MappedDStream@1b1cea2e\n\nactivityStream: org.apache.spark.streaming.dstream.DStream[Activity] = org.apache.spark.streaming.dstream.TransformedDStream@78951528\n\nwarning: there were two deprecation warnings; re-run with -deprecation for details\n"},"dateCreated":"2019-02-27T14:58:17-0500","dateStarted":"2019-02-27T15:10:41-0500","dateFinished":"2019-02-27T15:10:44-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:30"},{"text":"%sql select from_unixtime(timestamp_hour / 1000, \"MM-dd HH:mm:00\") as timestamphour, purchase_count, add_to_cart_count, page_view_count \n     from activityByProduct","dateUpdated":"2019-02-27T16:56:19-0500","config":{"colWidth":12,"graph":{"mode":"pieChart","height":300,"optionOpen":true,"keys":[{"name":"timestamphour","index":0,"aggr":"sum","$$hashKey":"object:332"}],"values":[{"name":"purchase_count","index":1,"aggr":"sum","$$hashKey":"object:341"}],"groups":[],"scatter":{"xAxis":{"name":"timestamphour","index":0,"aggr":"sum"},"yAxis":{"name":"purchase_count","index":1,"aggr":"sum"}}},"enabled":true,"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1551297788657_2024382584","id":"20190227-150308_1963756878","result":{"code":"SUCCESS","type":"TABLE","msg":"timestamphour\tpurchase_count\tadd_to_cart_count\tpage_view_count\n","comment":"","msgTable":[],"columnNames":[{"name":"timestamphour","index":0,"aggr":"sum","$$hashKey":"object:311"},{"name":"purchase_count","index":1,"aggr":"sum","$$hashKey":"object:312"},{"name":"add_to_cart_count","index":2,"aggr":"sum","$$hashKey":"object:313"},{"name":"page_view_count","index":3,"aggr":"sum","$$hashKey":"object:314"}],"rows":[]},"dateCreated":"2019-02-27T15:03:08-0500","dateStarted":"2019-02-27T15:22:39-0500","dateFinished":"2019-02-27T15:22:41-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:31"},{"text":"StreamingContext.getActive.foreach {_.stop(stopSparkContext = false, stopGracefully =true)}","dateUpdated":"2019-02-27T15:10:40-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":false,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1551297983397_-745552798","id":"20190227-150623_2062873836","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"2019-02-27T15:06:23-0500","dateStarted":"2019-02-27T15:08:40-0500","dateFinished":"2019-02-27T15:08:49-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:32"},{"text":"ssc.awaitTerminationOrTimeout(1000*60)","dateUpdated":"2019-02-27T15:10:40-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":false,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1551298120911_-1810321571","id":"20190227-150840_188016912","result":{"code":"SUCCESS","type":"TEXT","msg":"\nres13: Boolean = false\n"},"dateCreated":"2019-02-27T15:08:40-0500","dateStarted":"2019-02-27T15:09:06-0500","dateFinished":"2019-02-27T15:10:07-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:33"},{"text":"","dateUpdated":"2019-02-27T15:10:40-0500","config":{"colWidth":12,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1551298146603_1754239071","id":"20190227-150906_1000108882","result":{"code":"SUCCESS","type":"TEXT","msg":""},"dateCreated":"2019-02-27T15:09:06-0500","dateStarted":"2019-02-27T15:10:44-0500","dateFinished":"2019-02-27T15:10:46-0500","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:34"}],"name":"Streaming Aggregations","id":"2E52GJ8VX","angularObjects":{"2C1R946JS:shared_process":[],"2C2DAZJKC:shared_process":[],"2C373EEBH:shared_process":[],"2C32XGJVB:shared_process":[],"2C5JKXFMS:shared_process":[],"2C1Y98MED:shared_process":[],"2C3RQUGNZ:shared_process":[],"2C1NUDJ96:shared_process":[],"2C2VR5DWC:shared_process":[],"2C54QY527:shared_process":[],"2C1Q22K6T:shared_process":[],"2C57YMVFD:shared_process":[],"2C2PRQ37B:shared_process":[],"2C31ZXKSF:shared_process":[],"2C2JD3M9T:shared_process":[],"2C4C7ZFCA:shared_process":[],"2C27JKTHW:shared_process":[],"2C2EEMVA4:shared_process":[]},"config":{"looknfeel":"default"},"info":{}}